<?xml version="1.0" encoding="utf-8"?>
<Window
    x:Class="ace_run.MainWindow"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:local="using:ace_run"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    mc:Ignorable="d"
    Title="Ace Run">

    <Window.SystemBackdrop>
        <MicaBackdrop />
    </Window.SystemBackdrop>

    <Grid x:Name="RootGrid">

        <!-- Main content area: sidebar + content -->
        <Grid Grid.Row="0">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="200" />
                <ColumnDefinition Width="*" />
            </Grid.ColumnDefinitions>

            <!-- Sidebar -->
            <Border Grid.Column="0"
                BorderBrush="{ThemeResource DividerStrokeColorDefaultBrush}"
                BorderThickness="0,0,1,0">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="*" />
                    </Grid.RowDefinitions>
                    <TextBlock Grid.Row="0"
                        Text="Ace Run"
                        Style="{StaticResource TitleTextBlockStyle}"
                        HorizontalAlignment="Center"
                        Padding="0,15,0,15"
                    />
                    <ListView Grid.Row="1" x:Name="SidebarListView"
                        SelectionChanged="SidebarListView_SelectionChanged"
                        CanReorderItems="True"
                        CanDragItems="True"
                        AllowDrop="True"
                        DragItemsCompleted="SidebarListView_DragItemsCompleted"
                        Padding="4,4,4,4">
                        <ListView.Header>
                            <ListViewItem x:Name="UngroupedItem"
                                Tapped="UngroupedItem_Tapped"
                                Padding="12,4"
                                MinHeight="30"
                                HorizontalContentAlignment="Stretch">
                                <StackPanel Orientation="Horizontal" Spacing="8">
                                    <FontIcon Glyph="&#xE8FD;" FontSize="13"
                                        VerticalAlignment="Center" />
                                    <TextBlock x:Name="UngroupedItemLabel"
                                        FontSize="13"
                                        VerticalAlignment="Center" />
                                </StackPanel>
                            </ListViewItem>
                        </ListView.Header>
                        <ListView.ItemTemplate>
                            <DataTemplate x:DataType="local:FolderViewModel">
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="Auto" />
                                        <ColumnDefinition Width="*" />
                                    </Grid.ColumnDefinitions>

                                    <FontIcon Grid.Column="0"
                                        Glyph="&#xE8B7;"
                                        FontSize="13"
                                        Margin="0,0,8,0"
                                        VerticalAlignment="Center" />
                                    <TextBlock Grid.Column="1"
                                        Text="{x:Bind DisplayName, Mode=OneWay}"
                                        FontSize="13"
                                        VerticalAlignment="Center"
                                        TextTrimming="CharacterEllipsis" />
                                </Grid>
                            </DataTemplate>
                        </ListView.ItemTemplate>
                        <ListView.ItemContainerStyle>
                            <Style TargetType="ListViewItem"
                                BasedOn="{StaticResource DefaultListViewItemStyle}">
                                <Setter Property="Padding" Value="12,4" />
                                <Setter Property="MinHeight" Value="30" />
                                <Setter Property="HorizontalContentAlignment" Value="Stretch" />
                            </Style>
                        </ListView.ItemContainerStyle>
                    </ListView>
                </Grid>
            </Border>

            <!-- Content area -->
            <Grid Grid.Column="1">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="*" />
                </Grid.RowDefinitions>

                <!-- Toolbar row: workspace selector + action buttons -->
                <Grid Grid.Row="0" Padding="12,35,12,0">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto" />
                        <ColumnDefinition Width="Auto" />
                        <ColumnDefinition Width="*" />
                        <ColumnDefinition Width="Auto" />
                        <ColumnDefinition Width="Auto" />
                    </Grid.ColumnDefinitions>

                    <!-- Workspace ComboBox -->
                    <ComboBox Grid.Column="0"
                        x:Name="WorkspaceComboBox"
                        MinWidth="140"
                        VerticalAlignment="Center"
                        SelectionChanged="WorkspaceComboBox_SelectionChanged">
                        <ComboBox.ItemTemplate>
                            <DataTemplate x:DataType="local:WorkspaceViewModel">
                                <StackPanel Orientation="Horizontal" Spacing="8">
                                    <Ellipse Width="10" Height="10"
                                             Fill="{x:Bind ColorBrush, Mode=OneWay}"
                                             Visibility="{x:Bind HasColorVisibility, Mode=OneWay}"
                                             VerticalAlignment="Center" />
                                    <TextBlock Text="{x:Bind Name, Mode=OneWay}"
                                               VerticalAlignment="Center" />
                                </StackPanel>
                            </DataTemplate>
                        </ComboBox.ItemTemplate>
                    </ComboBox>

                    <!-- Manage workspaces button -->
                    <Button Grid.Column="1"
                        x:Name="ManageWorkspacesButton"
                        Margin="4,0,0,0"
                        Height="32"
                        VerticalAlignment="Center"
                        Click="ManageWorkspacesButton_Click">
                        <FontIcon Glyph="&#xE713;" FontSize="14" />
                    </Button>

                    <!-- New Folder -->
                    <Button Grid.Column="3"
                        x:Name="NewFolderButton"
                        Click="NewFolderButton_Click"
                        VerticalAlignment="Center"
                        Margin="0,0,8,0">
                        <StackPanel Orientation="Horizontal" Spacing="6">
                            <FontIcon Glyph="&#xE8B7;" FontSize="14" />
                            <TextBlock x:Uid="NewFolderButtonLabel" Text="New Folder" />
                        </StackPanel>
                    </Button>

                    <!-- Add -->
                    <Button Grid.Column="4"
                        x:Name="AddButton"
                        Click="AddButton_Click"
                        Style="{StaticResource AccentButtonStyle}"
                        VerticalAlignment="Center">
                        <StackPanel Orientation="Horizontal" Spacing="6">
                            <FontIcon Glyph="&#xE710;" FontSize="14" />
                            <TextBlock x:Uid="AddButtonLabel" Text="Add" />
                        </StackPanel>
                    </Button>
                </Grid>

                <!-- Search bar -->
                <AutoSuggestBox Grid.Row="1"
                    x:Name="SearchBox"
                    x:Uid="SearchBox"
                    PlaceholderText="Search apps..."
                    Margin="12,8,12,8"
                    QueryIcon="Find"
                    TextChanged="SearchBox_TextChanged" />

                <!-- App grid (normal mode) -->
                <GridView Grid.Row="2"
                    x:Name="AppGridView"
                    Padding="12,4,12,12"
                    SelectionMode="Single"
                    CanReorderItems="True"
                    CanDragItems="True"
                    AllowDrop="True"
                    DoubleTapped="AppGridView_DoubleTapped"
                    DragOver="AppGridView_DragOver"
                    Drop="AppGridView_Drop"
                    DragItemsCompleted="AppGridView_DragItemsCompleted"
                    RightTapped="AppGridView_RightTapped">
                    <GridView.ItemTemplate>
                        <DataTemplate x:DataType="local:AppItemViewModel">
                            <Grid Width="96" Height="88"
                                ToolTipService.ToolTip="{x:Bind FilePath}">
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="56" />
                                    <RowDefinition Height="32" />
                                </Grid.RowDefinitions>
                                <Image Grid.Row="0"
                                    Source="{x:Bind IconSource, Mode=OneWay}"
                                    Width="48" Height="48"
                                    VerticalAlignment="Center"
                                    HorizontalAlignment="Center"
                                    Stretch="Uniform" />
                                <TextBlock Grid.Row="1"
                                    Text="{x:Bind DisplayName, Mode=OneWay}"
                                    FontSize="11"
                                    TextWrapping="WrapWholeWords"
                                    MaxLines="2"
                                    TextAlignment="Center"
                                    TextTrimming="CharacterEllipsis"
                                    VerticalAlignment="Top"
                                    HorizontalAlignment="Center"
                                    Margin="2,0,2,0" />
                            </Grid>
                        </DataTemplate>
                    </GridView.ItemTemplate>
                </GridView>

                <!-- Search results (filtered mode) -->
                <ListView Grid.Row="2"
                    x:Name="SearchResultsView"
                    Visibility="Collapsed"
                    Padding="8,0,8,8"
                    SelectionMode="Multiple"
                    DoubleTapped="SearchResultsView_DoubleTapped"
                    KeyDown="SearchResultsView_KeyDown">
                    <ListView.ItemTemplate>
                        <DataTemplate x:DataType="local:AppItemViewModel">
                            <Grid Padding="4,4"
                                MinHeight="32"
                                ToolTipService.ToolTip="{x:Bind FilePath}">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto" />
                                    <ColumnDefinition Width="*" />
                                </Grid.ColumnDefinitions>

                                <Image Grid.Column="0"
                                    Source="{x:Bind IconSource, Mode=OneWay}"
                                    Width="20" Height="20"
                                    Margin="4,0,8,0"
                                    VerticalAlignment="Center"
                                    Stretch="Uniform" />
                                <TextBlock Grid.Column="1"
                                    Text="{x:Bind DisplayName, Mode=OneWay}"
                                    FontSize="14"
                                    VerticalAlignment="Center"
                                    TextTrimming="CharacterEllipsis" />
                            </Grid>
                        </DataTemplate>
                    </ListView.ItemTemplate>
                </ListView>

            </Grid>
        </Grid>
    </Grid>
</Window>
